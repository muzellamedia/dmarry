  <!DOCTYPE html>
  <html lang="ml">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Matrimony ‚Äî Login / Search / My Profile</title>
  <style>
    :root{--primary:#007bff;--danger:#d9534f;--muted:#666}
    body{font-family:Arial,Helvetica,sans-serif;background:#f3f3f3;margin:0;padding:18px}
    .container{max-width:1000px;margin:auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
    h2{text-align:center;margin:6px 0 16px}
    input,button,select,textarea{padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ddd;font-size:15px;box-sizing:border-box}
    button{background:var(--primary);color:#fff;border:none;cursor:pointer;padding:10px 14px;border-radius:6px}
    button:hover{opacity:.95}
    .small-btn{padding:8px 10px;font-size:14px}
    .flex{display:flex;gap:12px;align-items:center}
    .results{display:flex;flex-wrap:wrap;gap:15px;margin-top:20px;justify-content:center}
    .card{background:#fff;border:1px solid #e6e6e6;border-radius:8px;width:320px;padding:10px;box-shadow:0 2px 8px rgba(0,0,0,0.04);display:flex;flex-direction:column}
    .card img{width:100%;height:220px;object-fit:cover;border-radius:6px;cursor:pointer}
    .info{font-size:14px;text-align:left;margin-top:8px;overflow-x:auto}
    .info b{display:inline-block;width:110px}
    .no-photo{width:100%;height:220px;display:flex;align-items:center;justify-content:center;background:#eee;color:#555;font-size:20px;border-radius:6px}
    #error{color:red;margin-top:10px;text-align:center}
    .pagination{text-align:center;margin-top:15px}
    .footer-text{font-size:13px;color:#444;margin-top:14px;line-height:1.4;text-align:center}
    .register-note{font-size:14px;color:#333;margin-top:10px}
    .my-profile{max-width:540px;margin:20px auto 0;padding:18px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
    .my-profile img{width:160px;height:160px;object-fit:cover;border-radius:12px;border:3px solid #eee;display:block;margin:0 auto}
    .profile-details{margin-top:12px;text-align:center;line-height:1.6}
    .actions{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:14px}
    .action-btn{padding:8px 14px;border-radius:8px;border:none;cursor:pointer;background:var(--primary);color:#fff}
    .action-btn.danger{background:var(--danger)}
    .notice{color:var(--muted);font-size:13px;margin-top:8px;text-align:center}
    @media (max-width:640px){
      .card{width:92%}
      .container{padding:12px}
      .my-profile img{width:130px;height:130px}
    }
    /* ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ <style> ‡¥∏‡µÜ‡¥ï‡µç‡¥∑‡¥®‡¥ø‡µΩ ‡¥á‡¥§‡µç ‡¥ï‡µÇ‡¥ü‡¥ø ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥ï */
#pageEdit form{max-width:400px;margin:auto}
#pageEdit input, #pageEdit select, #pageEdit textarea{width: 100%;} /* ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥á‡µª‡¥™‡µÅ‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç 100% ‡¥µ‡µÄ‡¥§‡¥ø ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ */
@media (max-width:640px){
  /* ... (‡¥Æ‡¥±‡µç‡¥±‡µÜ‡¥®‡µç‡¥§‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥∏‡µç‡¥±‡µç‡¥±‡µà‡¥≤‡µÅ‡¥ï‡µæ ‡¥â‡¥£‡µç‡¥ü‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Ö‡¥§‡¥ø‡¥®‡µã‡¥ü‡µç ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥ï) */
}

    /* Modal */
    .modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.9);align-items:center;justify-content:center;padding:20px}
    .modal img{max-width:100%;max-height:90vh;border-radius:8px}
    .modal .close{position:absolute;top:18px;right:22px;color:#fff;font-size:28px;cursor:pointer}
  </style>
  </head>
  <body>
  <div class="container">

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <style>
        /* ‡¥°‡¥ø‡¥´‡µã‡µæ‡¥ü‡µç‡¥ü‡µç ‡¥Æ‡¥æ‡µº‡¥ú‡¥ø‡µª/‡¥™‡¥æ‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥®‡µÄ‡¥ï‡µç‡¥ï‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ */
        html, body {
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* ‡¥§‡¥ø‡¥∞‡¥∂‡µç‡¥ö‡µÄ‡¥®‡¥Æ‡¥æ‡¥Ø ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µã‡µæ ‡¥§‡¥ü‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ */
        }
    </style>
</head>
<body>

<div id="pageLogin"
  style="
    /* ‡¥≤‡µã‡¥ó‡¥ø‡µª ‡¥¨‡µã‡¥ï‡µç‡¥∏‡µç ‡¥∏‡µÜ‡¥®‡µç‡¥±‡µº ‡¥Ü‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡µç‡¥±‡µç‡¥±‡µà‡¥≤‡µÅ‡¥ï‡µæ */
    display:flex;
    justify-content:center;
    align-items:center;
    /* ‡¥Æ‡µÅ‡¥¥‡µÅ‡¥µ‡µª ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µÄ‡¥®‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥ï‡¥æ‡¥£‡¥æ‡µª */
    height:100vh;
    width:100vw; /* ‡¥¨‡µç‡¥∞‡µó‡¥∏‡¥±‡¥ø‡µª‡µç‡¥±‡µÜ ‡¥Æ‡µÅ‡¥¥‡µÅ‡¥µ‡µª ‡¥µ‡µÄ‡¥§‡¥ø‡¥Ø‡µÅ‡¥Ç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª */
    margin:0;
    padding:0;
    /* ‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡µç‡¥ó‡µç‡¥∞‡µó‡¥£‡µç‡¥ü‡µç ‡¥á‡¥Æ‡µá‡¥ú‡µç */
    background:url('https://lh3.googleusercontent.com/d/1K9yibKVBVgZaCJWLsT7qSVJoswP1uYMF') no-repeat center center / cover;
    box-sizing:border-box;
    background-color:#333; /* ‡¥á‡¥Æ‡µá‡¥ú‡µç ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥§‡µç‡¥§ ‡¥∏‡¥æ‡¥π‡¥ö‡¥∞‡µç‡¥Ø‡¥§‡µç‡¥§‡¥ø‡µΩ */
  ">

  <div style="
    /* ‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡µç‡¥ó‡µç‡¥∞‡µó‡¥£‡µç‡¥ü‡µç ‡¥™‡µÇ‡µº‡¥£‡µç‡¥£‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‡¥™‡¥∞‡µª‡µç‡¥±‡µç */
    background:none; 
    padding:30px 25px;
    border-radius:15px;
    /* ‡¥Æ‡µÅ‡¥¥‡µÅ‡¥µ‡µª ‡¥µ‡µÄ‡¥§‡¥ø‡¥Ø‡¥ø‡µΩ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª 100% ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ, max-width ‡¥®‡¥ø‡¥Ø‡¥®‡µç‡¥§‡µç‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ */
    width:100%; 
    /* ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥Æ‡µä‡¥¨‡µà‡¥≤‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥µ‡µÉ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥ø ‡¥ï‡¥æ‡¥£‡¥æ‡µª ‡¥™‡¥∞‡¥Æ‡¥æ‡¥µ‡¥ß‡¥ø ‡¥µ‡µÄ‡¥§‡¥ø (‡¥á‡¥§‡µç ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥Ç ‡¥Ö‡¥®‡µÅ‡¥∏‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥æ‡¥Ç) */
    max-width:380px; 
    text-align:center;
    /* ‡¥ü‡µÜ‡¥ï‡µç‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥ï‡¥≥‡µº ‡¥µ‡µà‡¥±‡µç‡¥±‡µç */
    color:#fff; 
    /* ‡¥ö‡µÜ‡¥±‡¥ø‡¥Ø ‡¥∑‡¥æ‡¥°‡µã ‡¥®‡µΩ‡¥ï‡¥ø, ‡¥¨‡µã‡¥ï‡µç‡¥∏‡¥ø‡¥®‡µç ‡¥í‡¥∞‡µÅ ‡¥°‡µÜ‡¥™‡µç‡¥§‡µç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ */
    box-shadow:0 8px 20px rgba(0,0,0,0.25); 
    backdrop-filter: blur(2px); 
    -webkit-backdrop-filter: blur(2px);
    /* ‡¥∏‡µà‡¥°‡µÅ‡¥ï‡¥≥‡¥ø‡µΩ ‡¥í‡¥∞‡µÅ ‡¥®‡¥ø‡¥∂‡µç‡¥ö‡¥ø‡¥§ ‡¥™‡¥æ‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ, ‡¥â‡¥≥‡µç‡¥≥‡¥ü‡¥ï‡µç‡¥ï‡¥Ç ‡¥Ö‡¥∞‡¥ø‡¥ï‡µÅ‡¥ï‡¥≥‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥Ö‡¥ï‡¥±‡µç‡¥±‡¥æ‡µª */
    padding-left: 25px;
    padding-right: 25px;
    box-sizing: border-box; /* padding ‡¥â‡¥Ç border ‡¥â‡¥Ç width-‡µΩ ‡¥â‡µæ‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§‡¥æ‡µª */
  ">

    <img src="https://lh3.googleusercontent.com/d/1pKfOnhW0cfZzRU8qkrcydfJeDWLMwB4e"
      alt="DM Logo"
      style="width:100px;height:100px;margin:0 auto 15px auto;display:block;border-radius:50%;border:3px solid #fff;">

    <h3 style="color:#ff0;font-size:16px;line-height:1.4;margin-bottom:20px;font-weight:600;">
      ‡¥ï‡µá‡¥∞‡¥≥‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÜ ‡¥≠‡¥ø‡¥®‡µç‡¥®‡¥∂‡µá‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µº‡¥ï‡µç‡¥ï‡µç ‡¥∏‡µó‡¥ú‡¥®‡µç‡¥Ø ‡¥Æ‡¥æ‡¥ü‡µç‡¥∞‡¥ø‡¥Æ‡µã‡¥£‡¥ø ‡¥µ‡µÜ‡¥¨‡µç‡¥∏‡µà‡¥±‡µç‡¥±‡µç
    </h3>
    
    <label style="display:block;text-align:left;font-size:14px;margin:6px 0 4px 4px;font-weight:500;">Your Phone Number</label>
    <input type="tel" id="phone" placeholder="Enter your registered phone number"
      style="width:100%;padding:12px;border:none;border-radius:6px;font-size:15px;margin-bottom:10px;box-sizing:border-box;background:rgba(255,255,255,0.9);color:#333;">

    <label style="display:block;text-align:left;font-size:14px;margin:6px 0 4px 4px;font-weight:500;">Date of Birth</label>
    <div style="display:flex;gap:6px;margin-bottom:15px;">
      <select id="day" style="flex:1;padding:12px;border:none;border-radius:6px;font-size:16px;box-sizing:border-box;background:rgba(255,255,255,0.9);color:#333;"><option value="">Day</option></select>
      <select id="month" style="flex:1;padding:12px;border:none;border-radius:6px;font-size:16px;box-sizing:border-box;background:rgba(255,255,255,0.9);color:#333;"><option value="">Month</option></select>
      <select id="year" style="flex:1;padding:12px;border:none;border-radius:6px;font-size:16px;box-sizing:border-box;background:rgba(255,255,255,0.9);color:#333;"><option value="">Year</option></select>
    </div>

    <button onclick="login()" 
      style="width:100%;padding:13px;border:none;border-radius:25px;background:#00b050;color:#fff;
      font-size:17px;font-weight:bold;cursor:pointer;margin-bottom:12px;transition:background 0.3s;">
      Login
    </button>

    <button onclick="showPage('pageRegister')" 
      style="width:100%;padding:13px;border:none;border-radius:25px;background:#001a66;color:#fff;
      font-size:17px;font-weight:bold;cursor:pointer;transition:background 0.3s;">
      Register Now
    </button>

    <div id="error" style="color:#ff8080;margin-top:10px;font-size:14px;"></div>
    <div style="font-size:12px;color:#0ff;margin-top:15px;">Designed by SUNEER PARAMBIL</div>

  </div>
</div>

</body>
</html>






    <div id="pageRegister" style="display:none;">
  <h2 style="text-align:center;">üìù Matrimony Registration Form</h2>

  <form id="regForm" style="max-width:600px;margin:auto;padding:15px;">
    <style>
      #regForm {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      #regForm label {
        font-weight: bold;
        margin-bottom: 3px;
      }
      #regForm input,
      #regForm select,
      #regForm textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
        box-sizing: border-box;
      }
      #regForm textarea {
        min-height: 80px;
      }
      .dob-selects {
        display: flex;
        gap: 8px;
      }
      .dob-selects select {
        flex: 1;
      }
      .btn-group button {
        background: #007bff;
        color: #fff;
        border: none;
        padding: 12px 20px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
      }
      .btn-group button:hover {
        background: #0056b3;
      }
      .btn-group {
        display: flex;
        justify-content: center;
        gap: 10px;
      }

      /* üåê Responsive */
      @media (max-width: 600px) {
        body {
          padding: 10px;
        }
        #regForm {
          gap: 12px;
        }
        .dob-selects {
          flex-direction: column;
        }
        .btn-group {
          flex-direction: column;
        }
        .btn-group button {
          width: 100%;
        }
      }
    </style>

    <label>Name</label>
    <input name="Name" required>

    <label>Your Phone Number</label>
    <input name="Your Phone Number" type="tel" required>

    <label>Date of Birth</label>
    <div class="dob-selects">
      <select name="Day" required><option value="">Day</option></select>
      <select name="Month" required><option value="">Month</option></select>
      <select name="Year" required><option value="">Year</option></select>
    </div>

    <label>Age</label>
    <input name="Age" type="number" min="18" max="100" required>

    <label>Gender</label>
    <select name="Gender" required>
      <option value="">Select</option>
      <option>Male</option>
      <option>Female</option>
    </select>

    <label>Height</label>
    <input name="Height">

    <label>Religion</label>
    <select name="Religion" required>
      <option value="">Select</option>
      <option>Muslim</option>
      <option>Hindu</option>
      <option>Christian</option>
    </select>

    <label>Caste</label>
    <input name="Caste">

    <label>Disability Details</label>
    <select name="Disability Details" required>
      <option value="">Select</option>
      <option>Deaf</option>
      <option>Blind</option>
      <option>Physical Disabilities</option>
      <option>Learning Disabilities</option>
      <option>MR</option>
      <option>Other Disabilities</option>
    </select>

    <label>Education</label>
    <input name="Education" required>

    <label>Job</label>
    <input name="Job">

    <label>Marital Status</label>
    <select name="Marital Status" required>
      <option value="">Select</option>
      <option>Unmarried</option>
      <option>Divorced</option>
      <option>Nikah Divorced</option>
    </select>

    <label>Full Address</label>
    <textarea name="Full Address" required></textarea>

    <label>District</label>
    <select name="District" required>
      <option value="">Select District</option>
      <option>Thiruvananthapuram</option>
      <option>Kollam</option>
      <option>Pathanamthitta</option>
      <option>Alappuzha</option>
      <option>Kottayam</option>
      <option>Idukki</option>
      <option>Ernakulam</option>
      <option>Thrissur</option>
      <option>Palakkad</option>
      <option>Malappuram</option>
      <option>Kozhikode</option>
      <option>Wayanad</option>
      <option>Kannur</option>
      <option>Kasaragod</option>
    </select>

    <label>Contact Number 1</label>
    <input name="Contact Number 1" required>

    <label>Contact Number 2</label>
    <input name="Contact Number 2">

    <label>About Me</label>
    <textarea name="About Me"></textarea>

    <label>Upload Your Photo</label>
    <input type="file" name="photoFile" accept="image/*">

    <div class="btn-group" style="margin-top:20px">
      <button id="submitBtn" type="button" onclick="registerUser()">Submit</button>
      <button type="button" onclick="showPage('pageLogin')" style="background:#ccc;color:#000;">Back to Login</button>
    </div>

    <div id="status" style="text-align:center;margin-top:8px;"></div>
  </form>
</div>

    <!-- SEARCH -->
<div id="pageSearch" style="display:none;">
  <h2>üîç Matrimony Profile Search</h2>

  <div style="display:flex;flex-direction:column;gap:15px;max-width:400px;margin:auto;"> 
    <!-- üëÜ ‡¥á‡¥®‡¥ø 3 ‡¥≤‡µà‡µª ‡¥Ü‡¥Ø‡¥ø column ‡¥Ü‡¥ï‡µç‡¥ï‡¥ø -->
    
     <!-- Age -->
    <div>
      <label>Age</label><br>
      <div style="display:flex;gap:8px;">
        <select id="ageMin" style="flex:1;padding:8px;border-radius:6px;border:1px solid #ccc;">
          <option value="">Min</option>
        </select>
        <select id="ageMax" style="flex:1;padding:8px;border-radius:6px;border:1px solid #ccc;">
          <option value="">Max</option>
        </select>
      </div>
    </div>
    <div>
      <label>District</label><br>
      <select id="district" style="width:100%;">
        <option value="">All</option>
        <option>Thiruvananthapuram</option>
        <option>Kollam</option>
        <option>Pathanamthitta</option>
        <option>Alappuzha</option>
        <option>Kottayam</option>
        <option>Idukki</option>
        <option>Ernakulam</option>
        <option>Thrissur</option>
        <option>Palakkad</option>
        <option>Malappuram</option>
        <option>Kozhikode</option>
        <option>Wayanad</option>
        <option>Kannur</option>
        <option>Kasaragod</option>
      </select>
    </div>

    <div>
      <label>Disability</label><br>
      <select id="disability" style="width:100%;">
        <option value="">All</option>
        <option>Deaf</option>
        <option>Blind</option>
        <option>Physical Disabilities</option>
        <option>Learning Disabilities</option>
        <option>MR</option> <!-- üëà ‡¥ö‡µá‡µº‡¥§‡µç‡¥§‡µÅ -->
        <option>Other Disabilities</option>
      </select>
    </div>
  </div>

  <div style="text-align:center;margin-top:18px;">
    <button onclick="applySearch()">Search</button>
    <button onclick="logout()" style="background:#dc3545;margin-left:10px;">Logout</button>
  </div>

  <div class="notice">Tip: Leave fields empty to include all.</div>
</div>
<script>
  // ‚úÖ Fill age dropdowns 18‚Äì65 dynamically
  const minSel = document.getElementById('ageMin');
  const maxSel = document.getElementById('ageMax');
  for (let i = 18; i <= 65; i++) {
    let opt1 = document.createElement('option');
    opt1.value = i; opt1.text = i;
    minSel.appendChild(opt1);
    let opt2 = document.createElement('option');
    opt2.value = i; opt2.text = i;
    maxSel.appendChild(opt2);
  }
  // Default values
  minSel.value = "18";
  maxSel.value = "65";
</script>


      <!-- MY PROFILE -->
<div id="myProfileSection" class="my-profile" style="display:none;max-width:600px;margin:auto;text-align:center;">

  <h2 style="color:#003366;margin-bottom:15px;">My Profile Details</h2>

  <img id="myProfilePhoto" 
       src="https://via.placeholder.com/150?text=No+Photo" 
       alt="Profile Photo" 
       style="width:140px;height:140px;border-radius:50%;border:4px solid #00b050;object-fit:cover;margin-bottom:15px;">

  <div id="myProfileDetails" class="profile-details" 
       style="background:#f9f9f9;border-radius:10px;padding:15px;margin-bottom:20px;text-align:left;box-shadow:0 0 6px rgba(0,0,0,0.1);">
  </div>

  <!-- Action Buttons Grid -->
  <div class="actions-grid" 
       style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-bottom:20px;">
    
    <button class="action-box" onclick="editProfile()" 
            style="background:#007bff;color:#fff;border:none;border-radius:12px;padding:15px 10px;font-weight:bold;
                   cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.2);">
      ‚úèÔ∏è<br>Edit Profile
    </button>
    
    <button class="action-box" onclick="changePhoto()" 
            style="background:#17a2b8;color:#fff;border:none;border-radius:12px;padding:15px 10px;font-weight:bold;
                   cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.2);">
      üì∏<br>Change Photo
    </button>
    
    <button class="action-box" onclick="deletePhoto()" 
            style="background:#ffc107;color:#000;border:none;border-radius:12px;padding:15px 10px;font-weight:bold;
                   cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.2);">
      üóëÔ∏è<br>Delete Photo
    </button>
    
    <button class="action-box" onclick="deleteProfile()" 
            style="background:#dc3545;color:#fff;border:none;border-radius:12px;padding:15px 10px;font-weight:bold;
                   cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.2);">
      ‚ùå<br>Delete Profile
    </button>
  </div>

  <p id="myProfileStatus" style="text-align:center;color:#666;font-size:14px;margin-top:5px;"></p>

  <div class="footer-text" style="margin-top:18px;font-size:13px;color:#555;line-height:1.4;">
    ‡¥≠‡¥ø‡¥®‡µç‡¥®‡¥∂‡µá‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥∞‡µç‡¥ï‡µç‡¥ï‡µç ‡¥µ‡¥ø‡¥µ‡¥æ‡¥π‡¥Æ‡µÜ‡¥®‡µç‡¥® ‡¥∏‡µç‡¥µ‡¥™‡µç‡¥®‡¥Ç ‡¥™‡µÇ‡¥µ‡¥£‡¥ø‡¥Ø‡¥æ‡µª ‡¥∏‡µó‡¥ú‡¥®‡µç‡¥Ø ‡¥µ‡µÜ‡¥¨‡µç‡¥∏‡µà‡¥±‡µç‡¥±‡µç<br>
    <strong>Website design by SUNEER PARAMBIL</strong>
  </div>
</div>

<div id="pageEdit" style="display:none;">
    <h2 style="text-align:center;">‚úèÔ∏è Edit Profile</h2>

    <form id="editForm" style="max-width:600px;margin:auto;padding:15px;">
        <style>
          #editForm {
            display: flex;
            flex-direction: column;
            gap: 12px;
          }
          #editForm label {
            font-weight: bold;
            margin-bottom: 3px;
            display: block; /* ‡¥≤‡µá‡¥¨‡¥≤‡µÅ‡¥ï‡µæ ‡¥µ‡µá‡µº‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª */
          }
          #editForm input,
          #editForm select,
          #editForm textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
          }
          #editForm textarea {
            min-height: 80px;
          }
        </style>

        <p style="color:#007bff; text-align:center; font-weight:bold;">Only listed fields are editable.</p>

        <label>Name</label>
        <input name="Name" id="editName" required>
        
        <label>Date of Birth (Not Editable)</label>
        <input name="Date of Birth" id="editDob" disabled style="background:#eee; color:#666;">

        <label>Height</label>
        <input name="Height" id="editHeight">
        
        <label>Disability Details</label>
        <select name="Disability Details" id="editDisability" required>
            <option value="">Select</option>
            <option>Deaf</option>
            <option>Blind</option>
            <option>Physical Disabilities</option>
            <option>Learning Disabilities</option>
            <option>MR</option>
            <option>Other Disabilities</option>
        </select>

        <label>Education</label>
        <input name="Education" id="editEducation" required>

        <label>Job</label>
        <input name="Job" id="editJob">

        <label>Marital Status</label>
        <select name="Marital Status" id="editMaritalStatus" required>
            <option value="">Select</option>
            <option>Unmarried</option>
            <option>Divorced</option>
            <option>Nikah Divorced</option>
        </select>
        
        <label>Full Address</label>
        <textarea name="Full Address" id="editAddress" required></textarea>

        <label>District</label>
        <select name="District" id="editDistrict" required>
            <option value="">Select District</option>
            <option>Thiruvananthapuram</option>
            <option>Kollam</option>
            <option>Pathanamthitta</option>
            <option>Alappuzha</option>
            <option>Kottayam</option>
            <option>Idukki</option>
            <option>Ernakulam</option>
            <option>Thrissur</option>
            <option>Palakkad</option>
            <option>Malappuram</option>
            <option>Kozhikode</option>
            <option>Wayanad</option>
            <option>Kannur</option>
            <option>Kasaragod</option>
        </select>

        <label>Contact Number 1</label>
        <input name="Contact Number 1" id="editContact1" required>

        <label>Contact Number 2</label>
        <input name="Contact Number 2" id="editContact2">
        
        <label>About Me</label>
        <textarea name="About Me" id="editAboutMe"></textarea>

        <div class="btn-group" style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
            <button type="button" onclick="updateProfile()" style="background:#28a745;">üíæ Update Profile</button>
            <button type="button" onclick="showPage('pageSearch')" style="background:#6c757d;">Back to Profile</button>
        </div>

        <div id="editStatus" style="text-align:center;margin-top:8px;"></div>
    </form>
</div>

    <!-- RESULTS -->
    <div id="pageResults" style="display:none">
      <h2>Search Results</h2>
      <div style="margin-bottom:10px;text-align:center">
        <button onclick="backToSearch()">Back to Search</button>
        <button onclick="logout()" style="background:#dc3545;margin-left:8px">Logout</button>
      </div>
      <div class="results" id="results"></div>
      <div class="pagination" id="pagination"></div>
      <div class="footer-text" style="margin-top:14px">‡¥≠‡¥ø‡¥®‡µç‡¥®‡¥∂‡µá‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥∞‡µç‡¥ï‡µç‡¥ï‡µç ‡¥µ‡¥ø‡¥µ‡¥æ‡¥π‡¥Æ‡µÜ‡¥®‡µç‡¥® ‡¥∏‡µç‡¥µ‡¥™‡µç‡¥®‡¥Ç ‡¥™‡µÇ‡¥µ‡¥£‡¥ø‡¥Ø‡¥æ‡µª ‡¥∏‡µó‡¥ú‡¥®‡µç‡¥Ø ‡¥µ‡µÜ‡¥¨‡µç‡¥∏‡µà‡¥±‡µç‡¥±‡µç ‚Äî Website design by SUNEER PARAMBIL</div>
    </div>

  </div>

<div id="imgModal" class="modal">
  <img class="modal-content" id="modalImg">
</div>

<script>
const modal = document.getElementById('imgModal');
const modalImg = document.getElementById('modalImg');

function openModal(src) {
  modal.style.display = 'flex';
  modalImg.src = src;
}

// ‡¥ü‡¥ö‡µç‡¥ö‡µç / ‡¥ï‡µç‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µç anywhere to close
modal.addEventListener('click', () => {
  modal.style.display = 'none';
});
</script>

<style>
.modal {
  display:none;
  position:fixed;
  z-index:1000;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.9);
  justify-content:center;
  align-items:center;
}
.modal-content {
  max-width:90%;
  max-height:90%;
  border-radius:10px;
}
</style>


<!-- MODAL HTML -->
<div id="imgModal" class="modal">
  <button class="close-btn" onclick="closeModal()">‚úñ</button>
  <img id="modalImg" src="" alt="Full image">
</div>

<script>
  const modal = document.getElementById("imgModal");
  const modalImg = document.getElementById("modalImg");

  // Open image fullscreen
  function openModal(src) {
    modalImg.src = src;
    modal.classList.add("show");
    document.body.classList.add("modal-open");
  }

  // Close modal
  function closeModal() {
    modal.classList.remove("show");
    document.body.classList.remove("modal-open");
  }
</script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
  /* ========== CONFIG ========== */
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby2tfPLs4XbkhijnDzAVktRbtL26FFHtdnGH-zvW3py6LfTaU6JkS156se4BHYvmlJM/exec"; // <-- set your script URL
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHJLHXWQaMioqSExrL-vdbu65_py6Ti9KzPtkxXaMaj9CygZ9OFH1a3ne7rCQ0_fF_KhNc-OiPDmvo/pub?output=csv"; // your published CSV

  /* ========== STATE ========== */
  let allProfiles = [];        // all rows from CSV
  let filteredProfiles = [];   // search results
  let currentPage = 1;
  const profilesPerPage = 10;
  let loggedProfile = null;    // object for logged-in user (row)
  let loggedInGender = "";

  /* ========== Helpers ========== */
function showPage(id){
  ["pageLogin","pageRegister","pageSearch","pageResults", "pageEdit"].forEach(pid=>{ 
    const el = document.getElementById(pid);
    if(el) el.style.display = (pid===id) ? "block" : "none";
  });
  
  // ‚úÖ ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç ‡¥µ‡¥∞‡µÅ‡¥§‡µç‡¥§‡¥ø
  const myProfileEl = document.getElementById('myProfileSection');
  if(myProfileEl) {
      // 'pageSearch' ‡¥é‡¥®‡µç‡¥® ‡¥™‡µá‡¥ú‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç ‡¥™‡µç‡¥∞‡µä‡¥´‡µà‡µΩ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï, ‡¥Æ‡¥±‡µç‡¥±‡µç ‡¥™‡µá‡¥ú‡µÅ‡¥ï‡¥≥‡¥ø‡µΩ ‡¥π‡µà‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.
      myProfileEl.style.display = (id === 'pageSearch' && loggedProfile) ? 'block' : 'none'; 
  }
  
  window.scrollTo({top:0,behavior:'smooth'});
}
  /* Fill day/month/year selects (used in login + register) */
  function fillDobSelects(){
    const dayEls = document.querySelectorAll("#day, select[name='Day']");
    const monthEls = document.querySelectorAll("#month, select[name='Month']");
    const yearEls = document.querySelectorAll("#year, select[name='Year']");
    if(dayEls[0].children.length===1){
      for(let i=1;i<=31;i++) dayEls.forEach(e=>e.insertAdjacentHTML('beforeend',`<option value="${i}">${i}</option>`));
    }
    if(monthEls[0].children.length===1){
      for(let i=1;i<=12;i++) monthEls.forEach(e=>e.insertAdjacentHTML('beforeend',`<option value="${i}">${i}</option>`));
    }
    if(yearEls[0].children.length===1){
      for(let i=new Date().getFullYear(); i>=1960; i--) yearEls.forEach(e=>e.insertAdjacentHTML('beforeend',`<option value="${i}">${i}</option>`));
    }
  }
  // fillDobSelects(); // ‚úÖ ‡¥à ‡¥ï‡µã‡µæ ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ø ‡¥Ö‡¥µ‡¥∏‡¥æ‡¥®‡¥Ç ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.

  /* Convert Google Drive share link to direct viewable lh3 url */
  function convertDriveLink(url) {
    if (!url) return "";

    // Case 1: already direct image (works for drive.google.com/uc)
    if (url.includes("https://drive.google.com/uc?export=view&id=")) {
      const fileId = url.split("id=")[1];
      return "https://lh3.googleusercontent.com/d/" + fileId;
    }

    // Case 2: open?id=xxxxx
    if (url.includes("open?id=")) {
      const fileId = url.split("open?id=")[1].split("&")[0];
      return "https://lh3.googleusercontent.com/d/" + fileId;
    }

    // Case 3: /file/d/xxxxx/
    if (url.includes("/file/d/")) {
      const fileId = url.split("/file/d/")[1].split("/")[0];
      return "https://lh3.googleusercontent.com/d/" + fileId;
    }

    // Default return
    return url;
  }
modal.addEventListener("click", (e) => {
  if (e.target === modal) closeModal();
});

 

  /* ========== LOGIN - (UPDATED) ========== */
  async function login(){
    const phone = document.getElementById('phone').value.trim();
    const day = document.getElementById('day').value;
    const month = document.getElementById('month').value;
    const year = document.getElementById('year').value;
    const err = document.getElementById('error');
    err.textContent = "";

    if(!phone){ err.textContent = "Please enter phone number."; return; }
    if(!day || !month || !year){ err.textContent = "Please select full date of birth."; return; }
    
    // User-entered DOB: Ensure it's in a clean, consistent format like "1/1/1990"
    const enteredDob = `${parseInt(day)}/${parseInt(month)}/${year}`;
    const enteredDobClean = enteredDob.replace(/[^\d]/g, "/").replace(/\s+/g, "").trim();

    try{
      const res = await fetch(SHEET_CSV_URL);
      const csv = await res.text();
      Papa.parse(csv,{
        header: true,
        skipEmptyLines: true,
        complete(results){
          allProfiles = results.data || [];
          
          const match = allProfiles.find(p=>{
            const phoneDb = (p["Your Phone Number"]||"").trim();
            const dobDb = (p["Date of Birth"]||"").trim();
            
            // Normalize DOB from Database (replace non-digits with / and clean up spaces)
            const dobDbClean = (dobDb||"").replace(/[^\d]/g,"/").replace(/\s+/g,"").trim();
            
            // Function to get clean D/M/Y parts
            const parseParts = s => {
                const parts = s.split("/").filter(Boolean).map(x => parseInt(x) || 0);
                if (parts.length < 3) return [0, 0, 0];
                return parts; // Assumes D/M/Y order based on CSV output
            };
            
            const [d1,m1,y1] = parseParts(dobDbClean);
            const [d2,m2,y2] = parseParts(enteredDobClean);
            
            const dobMatch = (d1===d2 && m1===m2 && y1===y2 && d1 !== 0);
            
            // ‚úÖ LOGIN CRITERIA: Phone must match AND DOB must match
            return phoneDb === phone && dobMatch;
          });

          if(match){
            loggedProfile = match;
            loggedInGender = (match.Gender||"").toLowerCase();
            const loggedReligion = (match.Religion||"").toLowerCase();
            const opposite = (loggedInGender==="male") ? "female" : "male";
            
            allProfiles = allProfiles.map(p=>p);
            const candidates = allProfiles.filter(p=>{
              return ((p.Gender||"").toLowerCase() === opposite) &&
                     ((p.Religion||"").toLowerCase() === loggedReligion);
            });
            
            filteredProfiles = candidates;
            showPage('pageSearch');
            showMyProfile(match);
            
            // Store necessary data in localStorage for action functions
            localStorage.setItem('loggedProfile', JSON.stringify({
                "Your Phone Number": match["Your Phone Number"],
                "Date of Birth": match["Date of Birth"],
            }));
            console.log("Profile saved to localStorage:", match["Your Phone Number"]);
          } else {
            err.textContent = "Invalid phone number or date of birth!";
          }
        }
      });
    } catch(e){
      err.textContent = "Error fetching data. Check CSV URL or network connection.";
      console.error(e);
    }
  }

  /* ========== LOGOUT (ADDED) ========== */
  function logout(){
      loggedProfile = null;
      localStorage.removeItem('loggedProfile');
      showPage('pageLogin');
      document.getElementById('myProfileSection').style.display = 'none';
      document.getElementById('error').textContent = "";
      document.getElementById('phone').value = "";
      document.getElementById('day').value = "";
      document.getElementById('month').value = "";
      document.getElementById('year').value = "";
  }

  /* ========== REGISTER ========== */
  async function registerUser(){
    const status = document.getElementById('status');
    const form = document.getElementById('regForm');

    if(!form.checkValidity()){
      status.style.color = 'red';
      status.textContent = 'Please fill required fields.';
      return;
    }

    const fd = new FormData(form);
    const fileInput = form.querySelector('input[name="photoFile"]');
    const file = fileInput.files[0];

    let base64 = "";
    if(file){
      const reader = await new Promise((res,rej)=>{
        const r = new FileReader();
        r.onload = e => res(e.target.result);
        r.onerror = rej;
        r.readAsDataURL(file);
      });
      base64 = reader.split(',')[1];
    }

    const params = new URLSearchParams();
    for(const [k,v] of fd.entries()){
      if(k === 'photoFile') continue;
      params.append(k, v);
    }
    params.append('photo', base64);
    params.append('photoName', file ? file.name : "");
    params.append('photoType', file ? file.type : "");

    try{
      status.style.color = '#555';
      status.textContent = 'Submitting...';
      const res = await fetch(SCRIPT_URL, { method: 'POST', body: params });
      const text = await res.text();
      if(text.includes('ALREADY_REGISTERED')){
        status.style.color = 'orange';
        status.textContent = 'This phone number is already registered. Please login.';
      } else if(text.includes('Success')){
        status.style.color = 'green';
        status.textContent = 'Registration successful ‚Äî please login.';
        form.reset();
      } else {
        status.style.color = 'red';
        status.textContent = 'Error: ' + text;
      }
    } catch(err){
      status.style.color = 'red';
      status.textContent = 'Network error.';
      console.error(err);
    }
  }

  /* ========== SEARCH ========== */
  function applySearch(){
    // if filteredProfiles empty (e.g. login didn't set), default to allProfiles
    const pool = (filteredProfiles && filteredProfiles.length>0) ? filteredProfiles : allProfiles;
    const ageMin = parseInt(document.getElementById('ageMin').value) || 18;
    const ageMax = parseInt(document.getElementById('ageMax').value) || 99;
    const district = (document.getElementById('district').value || "").toLowerCase();
    const disability = (document.getElementById('disability').value || "").toLowerCase();

    const results = pool.filter(p=>{
      const age = parseInt(p.Age) || calculateAge(p['Date of Birth']);
      const dist = (p.District||"").toLowerCase();
      const dis = (p['Disability Details']||"").toLowerCase();
      const ageOk = age >= ageMin && age <= ageMax;
      const distOk = !district || dist === district;
      const disOk = !disability || dis.includes(disability);
      return ageOk && distOk && disOk;
    });

    // set for pagination/display
    filteredProfiles = results;
    currentPage = 1;
    showPage('pageResults');
    displayProfiles();
  }

  /* ========== DISPLAY / PAGINATION ========== */
  function displayProfiles(){
    window.scrollTo({ top: 0, behavior: 'smooth' });
    const list = filteredProfiles || [];
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    if(list.length === 0){
      resultsDiv.innerHTML = "<p>No matching profiles found.</p>";
      document.getElementById("pagination").innerHTML = "";
      return;
    }

    const start = (currentPage - 1) * profilesPerPage;
    const end = start + profilesPerPage;
    const pageProfiles = list.slice(start, end);

    pageProfiles.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      const photoUrl = convertDriveLink(p["Photo Link"] || p["Upload Your Photo"] || "");
      const photoHtml = photoUrl
        ? `<img src="${photoUrl}" alt="photo" onclick="openModal('${photoUrl.replace(/'/g, "\\'")}')">`
        : `<div class="no-photo">No Photo</div>`;

      card.innerHTML = `
        ${photoHtml}
        <div class="info">
          <b>Name:</b> ${p.Name||''}<br>
          <b>Age:</b> ${calculateAge(p['Date of Birth']) || 'N/A'}<br>
          <b>Gender:</b> ${p.Gender||''}<br>
          <b>Religion:</b> ${p.Religion||''}<br>
          <b>Caste:</b> ${p.Caste||''}<br>
          <b>Disability:</b> ${p['Disability Details']||''}<br>
          <b>Education:</b> ${p.Education||''}<br>
          <b>Job:</b> ${p.Job||''}<br>
          <b>Marital Status:</b> ${p['Marital Status']||''}<br>
          <b>Full Address:</b> ${p['Full Address']||''}<br>
          <b>District:</b> ${p.District||''}<br>
          <b>Contact 1:</b> ${p['Contact Number 1']||''}<br>
          <b>Contact 2:</b> ${p['Contact Number 2']||''}<br>
          <b>About Me:</b> ${p['About Me']||''}<br>
        </div>`;
      resultsDiv.appendChild(card);
    });

    const paginationDiv = document.getElementById("pagination");
    paginationDiv.innerHTML = `<button onclick="prevPage()">Previous</button> Page ${currentPage} of ${Math.ceil(list.length / profilesPerPage)} <button onclick="nextPage()">Next</button>`;
  }

  function nextPage(){
    if(currentPage < Math.ceil(filteredProfiles.length / profilesPerPage)){
      currentPage++;
      displayProfiles();
      // Scroll to top smoothly
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

  function prevPage(){
    if(currentPage > 1){
      currentPage--;
      displayProfiles();
      // Scroll to top smoothly
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

 /* ========== MY PROFILE UI & ACTIONS (UPDATED) ========== */
function showMyProfile(profile){
  if(!profile) return;
  document.getElementById('myProfileSection').style.display = 'block';
  const photo = convertDriveLink(profile['Photo Link'] || profile['Upload Your Photo'] || "");
  document.getElementById('myProfilePhoto').src = photo || "https://via.placeholder.com/150?text=No+Photo";
  
  const details = document.getElementById('myProfileDetails');
  
  // ‚úÖ ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥∏‡µç‡¥±‡µç‡¥±‡µà‡¥≤‡¥ø‡¥Ç‡¥ó‡µç, ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥°‡µÄ‡¥±‡µç‡¥±‡µÜ‡¥Ø‡¥ø‡µΩ‡¥∏‡µç ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
  details.innerHTML = `
    <h3 style="margin:6px 0;">${escapeHtml(profile.Name||'')}</h3>
    
    <div style="text-align:left; margin: 10px auto; font-size: 15px;">
        <p><b>Date of Birth:</b> ${escapeHtml(profile["Date of Birth"]||'')}</p>
        <p><b>Age:</b> ${calculateAge(profile['Date of Birth']) || 'N/A'}</p>
        <p><b>Gender:</b> ${escapeHtml(profile.Gender||'')}</p>
        <p><b>Height:</b> ${escapeHtml(profile.Height||'')}</p>
        <p><b>Religion:</b> ${escapeHtml(profile.Religion||'')}</p>
        <p><b>Caste:</b> ${escapeHtml(profile.Caste||'')}</p>
        <p><b>Disability Details:</b> ${escapeHtml(profile["Disability Details"]||'')}</p>
        <p><b>Education:</b> ${escapeHtml(profile.Education||'')}</p>
        <p><b>Job:</b> ${escapeHtml(profile.Job||'')}</p>
        <p><b>Marital Status:</b> ${escapeHtml(profile["Marital Status"]||'')}</p>
        <p><b>District:</b> ${escapeHtml(profile.District||'')}</p>
        
        <div style="text-align:left; margin: 10px auto; font-size: 15px;">
            <b>Contact Number 1:</b> ${escapeHtml(profile["Contact Number 1"]||'')}</p>
        <p><b>Contact Number 2:</b> ${escapeHtml(profile["Contact Number 2"]||'')}</p>
        <p><b>Full Address:</b> ${escapeHtml(profile["Full Address"]||'')}</p>
        
        <p style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
            <b>About Me:</b> ${escapeHtml(profile["About Me"]||'')}</p>
    </div>
  `;
  
  // store locally for actions (only phone is needed for action identity)
  localStorage.setItem('loggedProfile', JSON.stringify({
      "Your Phone Number": profile["Your Phone Number"],
      "Date of Birth": profile["Date of Birth"],
  }));
  loggedProfile = profile;
  document.getElementById('myProfileStatus').textContent = "";
}


/* ‚úèÔ∏è EDIT PROFILE (NEW LOGIC) */
function editProfile() {
  if (!loggedProfile) { alert('Please login first'); return; }
  
  // 1. ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥´‡µã‡¥Æ‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
  document.getElementById('editName').value = loggedProfile.Name || '';
  document.getElementById('editDob').value = loggedProfile['Date of Birth'] || ''; // DOB is not editable
  document.getElementById('editHeight').value = loggedProfile.Height || '';
  document.getElementById('editDisability').value = loggedProfile['Disability Details'] || '';
  document.getElementById('editEducation').value = loggedProfile.Education || '';
  document.getElementById('editJob').value = loggedProfile.Job || '';
  document.getElementById('editMaritalStatus').value = loggedProfile['Marital Status'] || '';
  document.getElementById('editAddress').value = loggedProfile['Full Address'] || '';
  document.getElementById('editDistrict').value = loggedProfile.District || '';
  document.getElementById('editContact1').value = loggedProfile['Contact Number 1'] || '';
  document.getElementById('editContact2').value = loggedProfile['Contact Number 2'] || '';
  document.getElementById('editAboutMe').value = loggedProfile['About Me'] || '';
  
  document.getElementById('editStatus').textContent = "";
  
  // 2. ‡¥é‡¥°‡¥ø‡¥±‡µç‡¥±‡µç ‡¥™‡µá‡¥ú‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
  showPage('pageEdit');
}
 
/* üíæ UPDATE PROFILE (NEW LOGIC) */
async function updateProfile() {
  if (!loggedProfile) { 
      alert('Login required to update profile.'); 
      showPage('pageLogin');
      return; 
  }
  
  const status = document.getElementById('editStatus');
  const form = document.getElementById('editForm');
  
  // ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥´‡µÄ‡µΩ‡¥°‡µÅ‡¥ï‡µæ ‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç ‡¥™‡µÇ‡¥∞‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ö‡µç‡¥ö‡µÅ ‡¥é‡¥®‡µç‡¥®‡µç ‡¥â‡¥±‡¥™‡µç‡¥™‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
  if (!form.checkValidity()) {
      status.style.color = 'red';
      status.textContent = 'Please fill all required fields.';
      return;
  }
  
  const fd = new FormData(form);
  
  // Create URLSearchParams object from FormData to send to Apps Script
  const params = new URLSearchParams();
  for(const [key, value] of fd.entries()) {
      // DOB field disabled ‡¥Ü‡¥Ø‡¥§‡µÅ‡¥ï‡µä‡¥£‡µç‡¥ü‡µç FormData-‡¥Ø‡¥ø‡µΩ ‡¥µ‡¥∞‡¥ø‡¥≤‡µç‡¥≤, ‡¥Ö‡¥§‡µç Apps Script-‡µΩ ‡¥Ö‡¥µ‡¥ó‡¥£‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç.
      params.append(key, value);
  }
  
  // 1. Action ‡¥â‡¥Ç Phone ‡¥®‡¥Æ‡µç‡¥™‡¥±‡µÅ‡¥Ç ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
  params.append('action', 'editProfile');
  appendUserIdentity(params); // ‡¥á‡¥§‡µç 'phone' parameter ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ

  try {
      status.style.color = '#555';
      status.textContent = 'Updating profile...';
      
      const res = await fetch(SCRIPT_URL, { method: 'POST', body: params });
      const text = await res.text();

      if (text.includes('PROFILE_UPDATED')) {
          status.style.color = 'green';
          status.textContent = 'Profile updated successfully! Returning to search page...';
          
          // 2.5 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡µç ‡¥ï‡¥æ‡¥§‡µç‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç Apps Script ‡¥Ö‡¥™‡µç‡¥°‡µá‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç, CSV-‡¥Ø‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç ‡¥µ‡¥∞‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡¥Æ‡¥Ø‡¥Ç ‡¥®‡µΩ‡¥ï‡¥æ‡¥®‡¥æ‡¥£‡µç.
          setTimeout(async () => {
              // 1. login() ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥≥‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ CSV ‡¥±‡µÄ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç
              //    ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ö‡µç‡¥ö‡µç loggedProfile ‡¥Ö‡¥™‡µç‡¥°‡µá‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç
              //    search ‡¥™‡µá‡¥ú‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç (pageSearch) ‡¥™‡µã‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥Ç.
              await login(); 
              
              // 2. ‡¥à delay ‡¥ï‡µç‡¥ï‡µç ‡¥∂‡µá‡¥∑‡¥Ç ‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡¥±‡µç‡¥±‡¥∏‡µç ‡¥Æ‡µÜ‡¥∏‡µç‡¥∏‡µá‡¥ú‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥®‡µç‡¥®‡µÅ
              document.getElementById('editStatus').textContent = "Data Reloaded. Redirecting...";
              
          }, 2500); // 2.5 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡µç ‡¥°‡¥ø‡¥≤‡µá
          
      } else if (text.includes('PROFILE_NOT_FOUND')) {
          status.style.color = 'red';
          status.textContent = 'Error: Profile not found. Please re-login.';
      } else {
          status.style.color = 'red';
          status.textContent = 'Error updating profile: ' + text;
      }
  } catch(err) {
      status.style.color = 'red';
      status.textContent = 'Network error.';
      console.error(err);
  }
}

/* Change profile photo */
function changePhoto() {
  if (!loggedProfile) { alert('Please login first'); return; }

  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = async () => {
    const file = input.files[0];
    if (!file) return;
    if (!confirm('Replace your profile photo?')) return;

    const reader = new FileReader();
    reader.onload = async (e) => {
      const base64 = e.target.result.split(',')[1];
      const formData = new FormData();
      formData.append('action','updatePhoto'); 
      
      appendUserIdentity(formData); 
      
      formData.append('photo', base64);
      formData.append('photoName', file.name);
      formData.append('photoType', file.type || 'image/jpeg');

      const status = document.getElementById('myProfileStatus');
      status.style.color = '#555';
      status.textContent = 'Uploading photo... Please wait.';

      try {
        const res = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        const text = await res.text();
        if (text.includes('PHOTO_UPDATED')) {
          status.style.color = 'green';
          status.textContent = 'Photo updated successfully. Reloading profile...';
          
          // ‚úÖ ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ‡¥Ø‡¥æ‡¥£‡µç ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç
          // 2.5 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡¥ø‡¥®‡µç ‡¥∂‡µá‡¥∑‡¥Ç login() ‡¥´‡¥Ç‡¥ó‡µç‡¥∑‡µª ‡¥µ‡¥ø‡¥≥‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥™‡µç‡¥∞‡µä‡¥´‡µà‡µΩ ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ.
          // (Google Sheets-‡¥≤‡µÜ ‡¥Ö‡¥™‡µç‡¥°‡µá‡¥±‡µç‡¥±‡µç CSV-‡¥Ø‡¥ø‡µΩ ‡¥µ‡¥∞‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡¥Æ‡¥Ø‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ)
          setTimeout(async () => {
             // ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥≤‡µã‡¥ó‡¥ø‡µª ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥≥‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥∏‡µÜ‡µº‡¥ö‡µç‡¥ö‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‡¥é‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥µ‡µá‡¥£‡µç‡¥ü‡¥ø‡¥Ø‡¥æ‡¥£‡µç.
             // ‡¥≤‡µã‡¥ó‡¥ø‡µª ‡¥´‡¥Ç‡¥ó‡µç‡¥∑‡µª 'pageSearch' ‡¥≤‡µá‡¥ï‡µç‡¥ï‡¥æ‡¥£‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç, ‡¥Ö‡¥§‡µç ‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÜ ‡¥™‡µá‡¥ú‡µç ‡¥Ü‡¥£‡µç.
             await login();
             status.style.color = 'green';
             status.textContent = 'Profile photo updated!';
          }, 2500); // 2.5 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡µç ‡¥ï‡¥æ‡¥§‡µç‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
          
        } else {
          status.style.color = 'red';
          status.textContent = 'Failed: ' + text;
        }
      } catch (e) {
        status.style.color = 'red';
        status.textContent = 'Network error';
      }
    };
    reader.readAsDataURL(file);
  };
  input.click();
}

/* Delete profile photo */
async function deletePhoto() {
  if (!loggedProfile) { alert('Please login first'); return; }
  if (!confirm('Remove your profile photo?')) return;

  const formData = new FormData();
  // ‚úÖ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç: ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥Ü‡¥ï‡µç‡¥∑‡µª ‡¥™‡µá‡¥∞‡µç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
  formData.append('action', 'deletePhoto'); // ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ Apps Script ‡¥ï‡µã‡¥°‡¥ø‡µΩ ‡¥á‡¥§‡µç 'deletePhoto' ‡¥é‡¥®‡µç‡¥®‡µç ‡¥§‡¥®‡µç‡¥®‡µÜ‡¥Ø‡¥æ‡¥£‡µç ‡¥™‡µç‡¥∞‡¥§‡µÄ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç ‡¥µ‡¥∞‡µÅ‡¥§‡µç‡¥§‡µá‡¥£‡µç‡¥ü‡¥§‡¥ø‡¥≤‡µç‡¥≤.
                                            // 'deletePhotoByPhone' ‡¥é‡¥®‡µç‡¥®‡¥æ‡¥£‡µç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ, ‡¥Ö‡¥§‡µç ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥ï‡µä‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï.
  
  appendUserIdentity(formData); 

  const status = document.getElementById('myProfileStatus');
  status.style.color = '#555';
  status.textContent = 'Deleting photo...';

  try {
    const res = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
    const text = await res.text();
    if (text.includes('PHOTO_DELETED')) {
      status.style.color = 'green';
      status.textContent = 'Photo deleted';
      document.getElementById('myProfilePhoto').src = "https://via.placeholder.com/150?text=No+Photo";
    } else {
      status.style.color = 'red';
      status.textContent = 'Failed: ' + text;
    }
  } catch (e) {
    status.style.color = 'red';
    status.textContent = 'Network error';
  }
}

/* Delete entire profile */
async function deleteProfile() {
  if (!loggedProfile) { alert('Please login first'); return; }
  if (!confirm('‚ö†Ô∏è Delete your entire profile permanently? This cannot be undone.')) return;

  const formData = new FormData();
  // ‚úÖ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç: ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥Ü‡¥ï‡µç‡¥∑‡µª ‡¥™‡µá‡¥∞‡µç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
  formData.append('action', 'deleteProfile'); // ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ Apps Script ‡¥ï‡µã‡¥°‡¥ø‡µΩ ‡¥á‡¥§‡µç 'deleteProfile' ‡¥é‡¥®‡µç‡¥®‡µç ‡¥§‡¥®‡µç‡¥®‡µÜ‡¥Ø‡¥æ‡¥£‡µç ‡¥™‡µç‡¥∞‡¥§‡µÄ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç ‡¥µ‡¥∞‡µÅ‡¥§‡µç‡¥§‡µá‡¥£‡µç‡¥ü‡¥§‡¥ø‡¥≤‡µç‡¥≤.
                                              // 'deleteProfileByPhone' ‡¥é‡¥®‡µç‡¥®‡¥æ‡¥£‡µç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ, ‡¥Ö‡¥§‡µç ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥ï‡µä‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï.
  
  appendUserIdentity(formData); 

  const status = document.getElementById('myProfileStatus');
  status.style.color = '#555';
  status.textContent = 'Deleting profile...';

  try {
    const res = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
    const text = await res.text();
    if (text.includes('PROFILE_DELETED')) {
      status.style.color = 'green';
      status.textContent = 'Profile deleted.';
      logout();
    } else {
      status.style.color = 'red';
      status.textContent = 'Failed: ' + text;
    }
  } catch (e) {
    status.style.color = 'red';
    status.textContent = 'Network error';
  }
}

  /* ========== UTILS ========== */
  function calculateAge(dobString){
    if(!dobString) return null;
    // normalize digits in string
    const s = (dobString||'').replace(/[^\d]/g,' ').trim().split(/\s+/);
    if(s.length < 3) return null;
    const [d,m,y] = s.map(x=>parseInt(x)||0);
    if(!d || !m || !y) return null;
    const birth = new Date(y, m-1, d);
    const today = new Date();
    let age = today.getFullYear() - birth.getFullYear();
    const md = today.getMonth() - birth.getMonth();
    if(md < 0 || (md===0 && today.getDate() < birth.getDate())) age--;
    return age;
  }
  function escapeHtml(str){ 
  if(!str) return ''; 
  return String(str).replace(/[&<>"']/g, s => ({
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  }[s]));
}
  
  /* ‚úÖ Helper: Only include phone for security-sensitive actions */
  function appendUserIdentity(params) {
    let phone = "";

    try {
      const saved = localStorage.getItem("loggedProfile");
      if (saved) {
        loggedProfile = JSON.parse(saved);
        phone = (loggedProfile && loggedProfile["Your Phone Number"])
          ? String(loggedProfile["Your Phone Number"]).trim()
          : "";
      } else {
        console.warn("‚ö†Ô∏è No profile found in localStorage!");
      }
    } catch (err) {
      console.error("Error loading profile from localStorage:", err);
    }

    if (!phone) {
      alert("‚ö†Ô∏è Phone number missing. Please logout and login again.");
      return params;
    }

    // ‚úÖ Only append 'phone' (Used for server-side lookup/update)
    if (params instanceof FormData) {
      params.append("phone", phone);
    } else if (params instanceof URLSearchParams) {
      params.append("phone", phone);
    } else {
      console.warn("appendUserIdentity(): Unknown params type");
    }

    return params;
  }



  /* helper to go back to search from results */
  function backToSearch(){ showPage('pageSearch'); }

  /* Initialize ‚Äî fill DOB selects and show login */
  fillDobSelects(); // ‚úÖ ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ‡¥Ø‡¥æ‡¥£‡µç ‡¥à ‡¥ï‡µã‡¥°‡µç ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µá‡¥£‡µç‡¥ü‡¥§‡µç
  showPage('pageLogin');
  
  
  </script>
  </body>
  </html>
